<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lottie Diagnostic</title>
  <script src="https://unpkg.com/lottie-web@5.9.6/build/player/lottie.min.js"></script>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #0a1016;
      color: #cbd5e1;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #60a5fa;
      border-bottom: 2px solid #1e40af;
      padding-bottom: 10px;
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
    .panel {
      background: #1e293b;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #3b82f6;
    }
    .player-container {
      background: #000;
      border-radius: 8px;
      padding: 20px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #lottie-player {
      width: 100%;
      max-width: 500px;
      height: 300px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
    }
    .success {
      background: #065f46;
      color: #d1fae5;
    }
    .error {
      background: #7f1d1d;
      color: #fecaca;
    }
    .info {
      background: #1e3a8a;
      color: #bfdbfe;
    }
    .warning {
      background: #78350f;
      color: #fef3c7;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px 5px 5px 0;
    }
    button:hover {
      background: #2563eb;
    }
    button:disabled {
      background: #475569;
      cursor: not-allowed;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 15px 0;
    }
    .info-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px;
      font-size: 14px;
      margin: 10px 0;
    }
    .info-label {
      color: #94a3b8;
    }
    .info-value {
      color: #60a5fa;
      font-weight: bold;
    }
    select {
      background: #334155;
      color: #cbd5e1;
      border: 1px solid #475569;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      margin: 5px 0;
    }
    .log-entry {
      font-size: 12px;
      padding: 5px;
      border-left: 2px solid #475569;
      margin: 5px 0;
      padding-left: 10px;
    }
    .log-container {
      max-height: 200px;
      overflow-y: auto;
      background: #0f172a;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>üé¨ Lottie Animation Diagnostic</h1>
  
  <div class="container">
    <div class="panel">
      <h2>Animation Player</h2>
      <div class="player-container">
        <div id="lottie-player"></div>
      </div>
      
      <div class="controls">
        <button onclick="loadAnimation()" id="loadBtn">Load Animation</button>
        <button onclick="playAnimation()" id="playBtn" disabled>Play</button>
        <button onclick="pauseAnimation()" id="pauseBtn" disabled>Pause</button>
        <button onclick="stopAnimation()" id="stopBtn" disabled>Stop</button>
        <button onclick="restartAnimation()" id="restartBtn" disabled>Restart</button>
      </div>

      <div>
        <label for="url-select" style="display: block; margin: 10px 0; color: #94a3b8;">
          <strong>Select JSON Source:</strong>
        </label>
        <select id="url-select" style="width: 100%;">
          <option value="https://raw.githack.com/TheAVCfiles/Decrypt-The-Girl/main/assets/lottie/bloom-cinematic.json">
            RawGitHack CDN - Lottie Path (Default)
          </option>
          <option value="https://raw.githubusercontent.com/TheAVCfiles/Decrypt-The-Girl/main/assets/lottie/bloom-cinematic.json">
            GitHub Raw - Lottie Path
          </option>
          <option value="https://theavcfiles.github.io/Decrypt-The-Girl/assets/lottie/bloom-cinematic.json">
            GitHub Pages - Lottie Path
          </option>
          <option value="https://raw.githubusercontent.com/TheAVCfiles/Decrypt-The-Girl/main/assets/bloom-cinematic.json">
            GitHub Raw - Assets Root
          </option>
          <option value="https://theavcfiles.github.io/Decrypt-The-Girl/assets/bloom-cinematic.json">
            GitHub Pages - Assets Root
          </option>
          <option value="../assets/lottie/bloom-cinematic.json">
            Relative Path - Lottie
          </option>
          <option value="../assets/bloom-cinematic.json">
            Relative Path - Assets Root
          </option>
        </select>
      </div>
    </div>

    <div class="panel">
      <h2>Diagnostics</h2>
      <div id="status"></div>
      
      <h3>Animation Info</h3>
      <div id="animation-info" class="info-grid">
        <span class="info-label">Status:</span>
        <span class="info-value">Not loaded</span>
      </div>

      <h3>Event Log</h3>
      <div class="log-container" id="event-log"></div>
      <button onclick="clearLog()">Clear Log</button>
    </div>
  </div>

  <div class="panel" style="margin-top: 20px;">
    <h3>Library Information</h3>
    <div id="library-info"></div>
  </div>

  <script>
    let animation = null;
    let frameUpdateInterval = null;
    const eventLog = [];

    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      eventLog.push({ timestamp, message, type });
      updateEventLog();
    }

    function updateEventLog() {
      const logContainer = document.getElementById('event-log');
      logContainer.innerHTML = eventLog.slice(-20).reverse().map(entry => {
        const color = {
          'info': '#60a5fa',
          'success': '#34d399',
          'error': '#f87171',
          'warning': '#fbbf24'
        }[entry.type] || '#94a3b8';
        
        return `<div class="log-entry" style="border-color: ${color}">
          <span style="color: #64748b">[${entry.timestamp}]</span> ${entry.message}
        </div>`;
      }).join('');
    }

    function clearLog() {
      eventLog.length = 0;
      updateEventLog();
    }

    function updateStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function updateAnimationInfo(data = null) {
      const infoDiv = document.getElementById('animation-info');
      
      if (!animation) {
        infoDiv.innerHTML = `
          <span class="info-label">Status:</span>
          <span class="info-value">Not loaded</span>
        `;
        return;
      }

      const currentFrame = animation.currentFrame ? Math.floor(animation.currentFrame) : 0;
      const totalFrames = animation.totalFrames ? Math.floor(animation.totalFrames) : 0;
      const isPaused = animation.isPaused;
      
      infoDiv.innerHTML = `
        <span class="info-label">Status:</span>
        <span class="info-value">${isPaused ? 'Paused' : 'Playing'}</span>
        
        <span class="info-label">Current Frame:</span>
        <span class="info-value">${currentFrame} / ${totalFrames}</span>
        
        <span class="info-label">Frame Rate:</span>
        <span class="info-value">${animation.frameRate || 'N/A'} fps</span>
        
        <span class="info-label">Renderer:</span>
        <span class="info-value">${animation.renderer ? animation.renderer.rendererType : 'N/A'}</span>
        
        <span class="info-label">Loop:</span>
        <span class="info-value">${animation.loop ? 'Yes' : 'No'}</span>
        
        <span class="info-label">Autoplay:</span>
        <span class="info-value">${animation.autoplay ? 'Yes' : 'No'}</span>
      `;
    }

    function enableControls(enabled) {
      document.getElementById('playBtn').disabled = !enabled;
      document.getElementById('pauseBtn').disabled = !enabled;
      document.getElementById('stopBtn').disabled = !enabled;
      document.getElementById('restartBtn').disabled = !enabled;
    }

    async function loadAnimation() {
      const urlSelect = document.getElementById('url-select');
      const selectedUrl = urlSelect.value;
      const urlName = urlSelect.options[urlSelect.selectedIndex].text;
      
      log(`Loading animation from: ${urlName}`, 'info');
      updateStatus(`üîÑ Loading animation from ${urlName}...`, 'info');
      
      // Destroy existing animation
      if (animation) {
        animation.destroy();
        animation = null;
        if (frameUpdateInterval) {
          clearInterval(frameUpdateInterval);
          frameUpdateInterval = null;
        }
        log('Previous animation destroyed', 'info');
      }

      try {
        const container = document.getElementById('lottie-player');
        container.innerHTML = ''; // Clear container
        
        animation = lottie.loadAnimation({
          container: container,
          renderer: 'svg',
          loop: true,
          autoplay: true,
          path: selectedUrl
        });

        // Set up event listeners
        animation.addEventListener('DOMLoaded', () => {
          log('‚úì Animation DOM loaded', 'success');
          updateStatus('‚úì Animation loaded successfully!', 'success');
          updateAnimationInfo();
          enableControls(true);
        });

        animation.addEventListener('data_ready', () => {
          log('‚úì Animation data ready', 'success');
        });

        animation.addEventListener('loaded_images', () => {
          log('‚úì Images loaded', 'success');
        });

        animation.addEventListener('complete', () => {
          log('Animation loop completed', 'info');
        });

        animation.addEventListener('loopComplete', () => {
          log('Loop cycle completed', 'info');
        });

        animation.addEventListener('error', (error) => {
          log(`‚úó Animation error: ${error}`, 'error');
          updateStatus('‚úó Animation error occurred', 'error');
        });

        animation.addEventListener('data_failed', () => {
          log('‚úó Failed to load animation data', 'error');
          updateStatus('‚úó Failed to load animation data', 'error');
          enableControls(false);
        });

        // Update info periodically while playing
        if (frameUpdateInterval) {
          clearInterval(frameUpdateInterval);
        }
        frameUpdateInterval = setInterval(() => {
          if (animation && !animation.isPaused) {
            updateAnimationInfo();
          }
        }, 100);

      } catch (error) {
        log(`‚úó Error loading animation: ${error.message}`, 'error');
        updateStatus(`‚úó Error: ${error.message}`, 'error');
        enableControls(false);
      }
    }

    function playAnimation() {
      if (animation) {
        animation.play();
        log('‚ñ∂ Animation playing', 'success');
        updateAnimationInfo();
      }
    }

    function pauseAnimation() {
      if (animation) {
        animation.pause();
        log('‚è∏ Animation paused', 'info');
        updateAnimationInfo();
      }
    }

    function stopAnimation() {
      if (animation) {
        animation.stop();
        log('‚èπ Animation stopped', 'info');
        updateAnimationInfo();
      }
    }

    function restartAnimation() {
      if (animation) {
        animation.goToAndPlay(0);
        log('üîÑ Animation restarted', 'success');
        updateAnimationInfo();
      }
    }

    // Check library information
    function checkLibrary() {
      const libInfo = document.getElementById('library-info');
      
      if (typeof lottie !== 'undefined') {
        libInfo.innerHTML = `
          <div class="status success">‚úì Lottie library loaded successfully</div>
          <div class="info-grid">
            <span class="info-label">Library:</span>
            <span class="info-value">lottie-web</span>
            
            <span class="info-label">Version:</span>
            <span class="info-value">${lottie.version || '5.9.6 (from CDN URL)'}</span>
            
            <span class="info-label">Source:</span>
            <span class="info-value">unpkg.com CDN</span>
            
            <span class="info-label">Available Methods:</span>
            <span class="info-value">${Object.keys(lottie).length} methods</span>
          </div>
        `;
        log('‚úì Lottie library detected and loaded', 'success');
      } else {
        libInfo.innerHTML = `
          <div class="status error">‚úó Lottie library not found!</div>
          <p style="color: #f87171;">The lottie-web library failed to load. Check your internet connection and CDN availability.</p>
        `;
        log('‚úó Lottie library not detected', 'error');
      }
    }

    // Initialize on page load
    window.addEventListener('load', () => {
      checkLibrary();
      log('Diagnostic page loaded', 'success');
      updateStatus('Ready to load animation. Click "Load Animation" to start.', 'info');
    });

    // Log any global errors
    window.addEventListener('error', (event) => {
      log(`‚úó Global error: ${event.message}`, 'error');
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (frameUpdateInterval) {
        clearInterval(frameUpdateInterval);
        frameUpdateInterval = null;
      }
      if (animation) {
        animation.destroy();
        animation = null;
      }
    });
  </script>
</body>
</html>
